---
layout: post
title:  Dockerfile指令解读
description: 
modified:   2018-03-02 10:02:57
tags: [docker]
---

Dockerfile指令，用于构建docker image


## FROM 指定基础镜像
定制镜像，必须是在一个基础镜像上进行。所以在定制镜像时需要指定基础镜像。FROM就是指定基础镜像，Dockerfile中必须是第一条
指令

## RUN 执行命令
RUN指令是用来执行命令行命令的。

## COPY 复制文件

###格式
- shell格式：`COPY <源路径>   <目标路径>`
- exec格式：`COPY [<源路径>,  <目标路径>]`

- 目标路径可以是容器内的绝对路径，也可以是相对于工作目录的相对路径(工作目录可以用WORKDIR指令指定)
- 目标路径可以不用创建，目录不存在复制前会先创建此目录
- 源文件的各种元数据都会保留。比如读、写、执行权限、文件变更时间等

## ADD 更高级的复制文件
### 特点
ADD指令和COPY指令格式和性质基本一致，但是比COPY增加了一些功能。
- ADD的源路径可以是URL，Docker引擎会去下载这个链接的文件
到目标路径。
- 源路径还可以是压缩文件(tar, gzip, bzip2以及xz), Docker引擎会自动解压文件。

### 注意
但是Docker官方更推荐尽可能使用COPY，因为其语义明确，在需要解压文件的情境下再使用ADD。另外ADD指令会令镜像构建缓存失效，
从而可能会令镜像构建变的比较缓慢。

因此在选择使用COPY还是ADD的时候，可以遵循：	所有文件复制都使用COPY，仅在需要自动解压缩的场景下使用ADD

## CMD 容器启动命令

###格式
- shell格式：	CMD <命令>
- exec格式：	CMD ["可执行性文件", "参数1", "参数2"...]

用于指定在容器启动的时候需要执行的程序。 

- 这个命令可以在docker run运行时镜像名后面指定新的命令替代
- 使用CMD命令时，推荐使用exec格式, 因为shell格式最终被包装为`sh -c`的参数进行执行。eg: `CMD echo $HOME`最终将会是以
`CMD ["sh", "-c", "echo $HOME"]`。这就是为什么可以使用环境变量的原因。

### 注意
Docker不是虚拟机，容器中的应用都应该是前台执行，没有后台服务的概念。所以在CMD后面的命令都应该是前台调用


## ENTRYPOINT 入口点
